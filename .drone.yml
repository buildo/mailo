branches:
  - master
  - mailo-*

build:
  mailo:
    image: hseeberger/scala-sbt
    commands:
      - openssl cast5-cbc -d -in src/test/resources/application.conf.cast5 -pass pass:$$TEST_CREDENTIALS_PASS -out src/test/resources/application.conf
      - sbt test -Dsbt.ivy.home=/drone/.ivy

  publish:
    image: hseeberger/scala-sbt
    environment:
      BINTRAY_CREDENTIALS_FILE: './.bintrayCredentials'
    commands:
      - cat 'realm = Bintray API Realm' >> .bintrayCredentials
      - cat 'host = api.bintray.com' >> .bintrayCredentials
      - cat 'user = $$BINTRAY_USERNAME' >> .bintrayCredentials
      - cat 'password = $$BINTRAY_PASSWORD' >> .bintrayCredentials
      - cat 'bintrayCredentialsFile := new File(".bintrayCredentials")' >> build.sbt
      - sbt publish -Dsbt.ivy.home=/drone/.ivy
    when:
      event: tag

cache:
  mount:
    - /drone/.ivy
